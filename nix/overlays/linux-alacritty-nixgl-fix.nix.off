final: prev: {
  alacritty = final.lib.makeOverridable (
    {
      alacritty ? prev.alacritty,
      nixgl ? final.nixgl.auto.nixGLDefault,
    }:
    if final.stdenv.isLinux && !(builtins.pathExists "/etc/NIXOS") then
      final.writeShellScriptBin "alacritty" ''
        #!/bin/sh
        ${nixgl}/bin/nixGL ${alacritty}/bin/alacritty "$@"
      ''
    else
      alacritty
  ) { };
}
